/* created by zefie <zefie@zefie.com> */

/dts-v1/;

#include <dt-bindings/gpio/gpio.h>
#include <dt-bindings/input/input.h>
#include <dt-bindings/interrupt-controller/irq.h>
#include "sun5i-a13.dtsi"
#include "sunxi-common-regulators.dtsi"

/* #include "sun5i-reference-design-tablet.dtsi" */

/ {

	model = "Othernet A13-Dreamcatcher";
	compatible = "othernet,a13-dreamcatcher", "allwinner,sun5i-a13";

        aliases {
                serial0 = &uart0;
        };

	backlight: backlight {
		compatible = "gpio-backlight";
		gpios = <&pio 3 23 GPIO_ACTIVE_HIGH>;
	};

	leds {
		compatible = "gpio-leds";

		heartbeat {
			gpios = <&pio 3 12 GPIO_ACTIVE_HIGH>;
			linux,default-trigger = "heartbeat";
		};

		storage {
			gpios = <&pio 3 13 GPIO_ACTIVE_HIGH>;
			linux,default-trigger = "mmc0";
		};

                ext_storage {
                        gpios = <&pio 3 2 GPIO_ACTIVE_HIGH>;
                        linux,default-trigger = "mmc1";
                };

                audio {
                        gpios = <&pio 3 3 GPIO_ACTIVE_HIGH>;
                        linux,default-trigger = "transient";
                };
	};

	chosen {
		stdout-path = "serial0:115200n8";
		framebuffer@0 {
			status = "okay";
		};

                mali: gpu@1c40000 {
                        compatible = "allwinner,sun4i-a10-mali", "arm,mali-400";
                        reg = <0x01c40000 0x10000>;
                        interrupts = <69>,
                                     <70>,
                                     <71>,
                                     <72>,
                                     <73>;
                        interrupt-names = "gp",
                                          "gpmmu",
                                          "pp0",
                                          "ppmmu0",
                                          "pmu";
                        clocks = <&ccu CLK_AHB_GPU>, <&ccu CLK_GPU>;
                        clock-names = "bus", "core";
                        resets = <&ccu RST_GPU>;

                        assigned-clocks = <&ccu CLK_GPU>;
                        assigned-clock-rates = <384000000>;
                };
	};
};

&i2c0 {
        pinctrl-names = "default";
        pinctrl-0 = <&i2c0_pins_a>;
        status = "okay";
        axp209: pmic@34 {
                reg = <0x34>;
                interrupts = <0>;
        };
};

&i2c1 {
        pinctrl-names = "default";
        pinctrl-0 = <&i2c1_pins_a>;
        status = "okay";
};

#include "axp209.dtsi"

&ac_power_supply {
        status = "okay";
};

&battery_power_supply {
        status = "okay";
};

&reg_dcdc2 {
        regulator-always-on;
        regulator-min-microvolt = <1000000>;
        regulator-max-microvolt = <1500000>;
        regulator-name = "vdd-cpu";
};

&reg_dcdc3 {
        regulator-always-on;
        regulator-min-microvolt = <1000000>;
        regulator-max-microvolt = <1400000>;
        regulator-name = "vdd-int-pll";
};

&reg_ldo1 {
        regulator-name = "vdd-rtc";
};

&reg_ldo2 {
        regulator-always-on;
        regulator-min-microvolt = <3000000>;
        regulator-max-microvolt = <3000000>;
        regulator-name = "avcc";
};

&reg_ldo3 {
        regulator-min-microvolt = <3300000>;
        regulator-max-microvolt = <3300000>;
        regulator-name = "vcc-wifi";
};

&reg_usb0_vbus {
        gpio = <&pio 6 12 GPIO_ACTIVE_HIGH>; /* PG12 */
        status = "okay";
};


&codec {
	status = "okay";
};

&fe0 {
        status = "okay";
};

&be0 {
        status = "okay";
};

&tcon0 {
	status = "okay";
};

&lradc {
	status = "disabled";
};

&pwm {
        pinctrl-names = "default";
        pinctrl-0 = <&pwm0_pins>;
        status = "okay";
};

&cpu0 {
	cpu-supply = <&reg_dcdc2>;
	// remove first row of numbers to disable overclock
	operating-points = <	
		/* kHz    uV */
		1104000 1400000
		1008000 1400000
		9120000 1350000
		 864000 1300000
		 624000 1200000
		 576000 1200000
		 432000 1200000
	>;
};

&ehci0 {
        status = "okay";
};

&uart0 {
        status = "okay";
};

&usb_otg {
        dr_mode = "otg";
        status = "okay";
};

&spi0 {
        pinctrl-names = "default";
	pinctrl-0 = <&spi0_pins_a>,
		    <&spi0_cs0_pin_a>;
        status = "okay";

	touchscreen@0 {
		compatible = "ti,ads7846";
		reg = <0>;
		spi-max-frequency = <2000000>;
		interrupt-parent = <&pio>;
		interrupts = <1 10 2>; /* IRQ_TYPE_EDGE_FALLING */
		pendown-gpio = <&pio 1 10 GPIO_ACTIVE_HIGH>;
		ti,x-plate-ohms = /bits/ 16 <100>;
		ti,pressure-max = /bits/ 16 <255>;
	};
};

&spi1 {
        pinctrl-names = "default";
	pinctrl-0 = <&spi1_pins_a>,
		    <&spi1_cs0_pin_a>;
	status = "okay";
	panel: display@0{
	/*
		// tinydrm mode
		compatible = "mi,mi0283qt";
		rotation = <180>;
		reset-gpios = <&pio 3 21 GPIO_ACTIVE_HIGH>;
		dc-gpios = <&pio 3 7 GPIO_ACTIVE_HIGH>;
	*/

		// fbtft mode
		compatible = "ilitek,ili9341";
		rotate = <270>;
		reset-gpios = <&pio 3 21 GPIO_ACTIVE_LOW>;
		dc-gpios = <&pio 3 7 GPIO_ACTIVE_LOW>;

		// common
		reg = <0>;
		spi-max-frequency = <48000000>;
		bgr;
		buswidth = <8>;
		backlight = <&backlight>;
		debug = <3>;
		width-mm = <49>;
                height-mm = <38>;
	
		port {
			panel_input: endpoint {
				remote-endpoint = <&tcon0_out_lcd>;
			};
		};

	};
};

&spi2 {
        pinctrl-names = "default";
	pinctrl-0 = <&spi2_pins_a>,
		    <&spi2_cs0_pin_a>;
	status = "okay";
};

&tcon0_out {
        tcon0_out_lcd: endpoint@0 {
                reg = <0>;
                remote-endpoint = <&panel_input>;
        };
};

&mmc0 {
	pinctrl-names = "default";
	pinctrl-0 = <&mmc0_pins_a>, <&mmc0_cd_pin>;
	vmmc-supply = <&reg_vcc3v0>;
	bus-width = <4>;
	cd-gpios = <&pio 6 0 GPIO_ACTIVE_LOW>; /* PG0 */
        status = "okay";
};

&mmc1 {
	status = "disabled";
};

&mmc2 {
        pinctrl-names = "default";
	pinctrl-0 = <&mmc2_pins>;
	vmmc-supply = <&reg_vcc3v0>;
	bus-width = <4>;
	cd-gpios = <&pio 2 12 GPIO_ACTIVE_LOW>;
        status = "okay";
	mmccard@0 {
		broken-hpi;
		compatible = "mmc-card";
		reg = <0>;
	};

};

&otg_sram {
        status = "okay";
};

&pio {
	led_pins_dreamcatcher: led_pins@0 {
		allwinner,drive = <1>;
		allwinner,function = "gpio_out";
		allwinner,pins = "PD4", "PD5", "PD6", "PD7", "PD10", "PD11", "PD12", "PD13", "PD14", "PD21", "PD22";
		allwinner,pull = <0>;
	};


        mmc0_cd_pin: mmc0_cd_pin@0 {
                pins = "PG0";
                function = "gpio_in";
                bias-pull-up;
        };

	spi0_cs0_pin_a: spi0-cs0@0 {
		allwinner,drive = <0>;
		allwinner,function = "spi0";
		allwinner,pins = "PC3";
		allwinner,pull = <0>;
	};

	spi0_pins_a: spi0@0 {
		allwinner,drive = <0>;
		allwinner,function = "spi0";
		allwinner,pins = "PC2", "PC0", "PC1";
		allwinner,pull = <0>;
	};


	spi1_cs0_pin_a: spi1-cs0@0 {
		allwinner,drive = <0>;
		allwinner,function = "spi1";
		allwinner,pins = "PG9";
		allwinner,pull = <0>;
	};

	spi1_pins_a: spi1@0 {
		allwinner,drive = <0>;
		allwinner,function = "spi1";
		allwinner,pins = "PG10", "PG11", "PG12";
		allwinner,pull = <0>;
	};

	spi2_cs0_pin_a: spi2-cs0@0 {
		allwinner,drive = <00>;
		allwinner,function = "spi2";
		allwinner,pins = "PE0";
		allwinner,pull = <0>;
	};

	spi2_pins_a: spi2@0 {
		allwinner,drive = <0>;
		allwinner,function = "spi2";
		allwinner,pins = "PE1", "PE2", "PE3";
		allwinner,pull = <0>;
	};

	mmc2_pins: mmc2@0 {
		allwinner,drive = <2>;
		allwinner,function = "mmc2";
		allwinner,pins = "PC6", "PC7", "PC8", "PC9", "PC10", "PC11";
		allwinner,pull = <0>;
	};

	mmc2_cd_pin_a: mmc2_cd_pin@0 {
		allwinner,drive = <0>;
		allwinner,function = "gpio_in";
		allwinner,pins = "PC12";
		allwinner,pull = <1>;
	};

        usb0_vbus_detect_pin: usb0_vbus_detect_pin@0 {
                pins = "PG1";
                function = "gpio_in";
                bias-pull-down;
        };

        usb0_id_detect_pin: usb0_id_detect_pin@0 {
                pins = "PG2";
                function = "gpio_in";
                bias-pull-up;
        };

        usb0_vbus_pin_a: usb0_vbus_pin@0 {
                pins = "PG12";
                function = "gpio_out";
        };
};

&uart1 {
        pinctrl-names = "default";
        pinctrl-0 = <&uart1_pins_b>;
        status = "okay";
};

&usb_otg {
        dr_mode = "otg";
        status = "okay";
};

&usb_power_supply {
        status = "okay";
};

&usbphy {
        pinctrl-names = "default";
        pinctrl-0 = <&usb0_id_detect_pin>, <&usb0_vbus_detect_pin>;
        usb0_id_det-gpio = <&pio 6 2 GPIO_ACTIVE_HIGH>; /* PG2 */
        usb0_vbus_det-gpio = <&pio 6 1 GPIO_ACTIVE_HIGH>; /* PG1 */
        usb0_vbus_power-supply = <&usb_power_supply>;
        usb0_vbus-supply = <&reg_usb0_vbus>;
        usb1_vbus-supply = <&reg_ldo3>;
        status = "okay";
};

